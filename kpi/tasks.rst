==============================
Задания на лабораторные работы
==============================

ЛР 1: Первое Embedded-приложение
--------------------------------

Название директории ЛР: ``lab1_first_embedded_app``

#. Ознакомиться с `Reference Manual BBXM <https://github.com/beagleboard/beagleboard-xm>`__.
   Это референсный документ, нет необходимости читать его от корки до корки. Вместо этого, стоит обращаться к конкретным
   интересующим топикам.

#. Выкачать последний оффициальный Debian Stretch for BeagleBoard образ с https://beagleboard.org/latest-images

#. Разархивировать и записать на SD-карту
   
   **Внимание**: команда ``dd``, запущенная с привилегиями, берет и пишет.
   Если указать ``of=``, скажем ``/dev/sda`` – винчестер будет испорчен. Перед
   запуском стоит посмотреть вывод ``ls /dev`` и убедиться, что назначение действительно
   указано верно.
   
   .. code-block::
     
     sudo sh -c "xz --decompress --keep --stdout bbxm-debian.img.xz | dd status=progress bs=4M of=/dev/mmcblk1; sync"
   
   Процесс занимает порядка 15..18 минут.
   
   *Контрольные вопросы*:
   
   - Что делает оператор ``|``? Привести пример аналогичной команды без его использования. В чем будет её недостаток?
   - Что содержит ``/dev`` и какой принцип энумерации у блочных устройств Linux?
   - Как работает указанная выше команда? Что значит каждый из флагов и операторов?

#. Подключиться RS-232 шнуром к плате. Открыть терминал с настройками 
   `115200 8/N/1 <https://en.wikipedia.org/wiki/Serial_port#Conventional_notation>`__
   
   *Внимание*: RS-232 – старый интерфейс, он не поддерживает горячее подключение. Поэтому, предварительно необходимо отключать
   питание устройства перед каждым подключением/отключением RS-232.

#. Вставить SD-карту в BBXM и подключить питание
   
   *Важно*: в момент когда плата работает, файловая система подмонтирована, к ней происходят регулярные
   обращения. Например, пишутся логи. Поэтому отключать питание платы выдергиванием шнура не рекомендуется –
   возможно повреждение файловой системы. Она, конечно, является журналируемой и может восстановиться с практически
   стопроцентной вероятностью после любого сбоя питания. Тем не менее, это может потребовать запуска проверки файловой
   системы, что является накладным (аналогией можно считать регулярное завершение работы десктопного ПК зажатием кнопки питания).
   Хорошей практикой является завершение работы командами ``shutdown now``, ``poweroff -p`` и подобными.

   *Контрольные вопросы*:
   
   - Что можно наблюдать в терминале? Почему использование последовательного интерфейса оправдано?
   - Каково назначение светодиодов на плате в конфигурации по-умолчанию?

#. На данном этапе RS-232 больше не требуется, поскольку плата BBXM имеет USB OTG, а используемый дистрибутив
   реализует Ethernet over USB. Отключите питание платы, отключите RS-232 шнур и подключите miniUSB **в OTG**
   разъём платы. Включите питание.
   
   
   Убедитесь, что софтверный USB-хаб *ID 1d6b:0104 Linux Foundation Multifunction Composite Gadget* присутствует в выводе
   ``lsusb`` и соответствующий сетевой интерфейс был распознан и добавлен (в выводе ``ip``).
   
   .. code-block::
     
     lsusb
     ip link show

   Добавьте `правила udev из mkudevrule.sh <https://beagleboard.org/getting-started#troubleshooting>`__, следуя инструкциям.

#. Дистрибутив BBXM реализует DHCP-сервер. При подключении сетевого интерфейса, компьютер должен сам получить IP-адрес по
   DHCP. Если этого не происходит, можно выставить IP-адрес вручную (192.168.6.1/24 или 192.168.7.1/24).

   Проверить, что сетевые пакеты доходят нормально

   .. code-block::
     
     ping 192.168.6.2
   
   или
   
   .. code-block::
     
     ping 192.168.7.2
   
   После чего отключить компьютер от интернета и в браузере вбить соответствующий IP-адрес BBXM. Должна открыться
   страница встроенного веб-сервера.

   *Контрольные вопросы*:
   
   - Чем USB Host отличается от USB OTG?
   - Как работает Ethernet over USB BBXM?
   - Для чего необходимо добавление правил udev? Объяснить содержимое файла
     `mkudevrule.sh <https://beagleboard.org/static/Drivers/Linux/FTDI/mkudevrule.sh>`__

#. Подключиться к BBXM по ssh. По-умолчанию логин – ``debian``, пароль – ``temppwd``
   
   .. code-block::
     
     ssh debian@192.168.6.2
   
   Для получения root-доступа, можно использовать ``sudo su``. Тем не менее, **настоятельно не рекомендуется**
   работать от имени *root*, предпочтительным способом является выполнение отдельных привелегированных 
   команд, используя ``sudo``.

   *Контрольные вопросы*:
   
   - Какая версия ядра запущена на BBXM? Что необходимо сделать, что бы её посмотреть?
   - Какие демоны и сервисы запущены? Как это посмотреть?
   - Какой объём оперативной памяти свободен на данном этапе? Как это посмотреть?
   - Предложить варианты освобождения оперативной памяти
   - Как изменить пароль по-умолчанию на пользовательский?
